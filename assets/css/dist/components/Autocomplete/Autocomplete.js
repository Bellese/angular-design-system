"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Autocomplete=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();require("core-js/fn/array/find");var _Button=require("../Button/Button"),_Button2=_interopRequireDefault(_Button),_downshift=require("downshift"),_downshift2=_interopRequireDefault(_downshift),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_react=require("react"),_react2=_interopRequireDefault(_react),_TextField=require("../TextField/TextField"),_TextField2=_interopRequireDefault(_TextField),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),_lodash=require("lodash.uniqueid"),_lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function isTextField(child){return null!=child&&child.type===_TextField2.default}var Autocomplete=exports.Autocomplete=function(_React$PureComponent){function Autocomplete(props){_classCallCheck(this,Autocomplete);var _this=_possibleConstructorReturn(this,(Autocomplete.__proto__||Object.getPrototypeOf(Autocomplete)).call(this,props));return _this.id=(0,_lodash2.default)("autocomplete_"),_this.labelId=(0,_lodash2.default)("autocomplete_header_"),_this.listboxId=(0,_lodash2.default)("autocomplete_owned_listbox_"),_this}return _inherits(Autocomplete,_react2.default.PureComponent),_createClass(Autocomplete,[{key:"filterItems",value:function filterItems(items,inputValue,getInputProps,getItemProps,highlightedIndex){var _this2=this;return this.props.loading?_react2.default.createElement("li",{className:"ds-c-autocomplete__list-item--message"},this.props.loadingMessage):items.length?items.map((function(item,index){return _react2.default.createElement("li",_extends({"aria-selected":highlightedIndex===index,className:highlightedIndex===index?"ds-c-autocomplete__list-item ds-c-autocomplete__list-item--active":"ds-c-autocomplete__list-item",key:item.id,role:"option"},getItemProps({item:item})),_this2.props.itemToString(item))})):_react2.default.createElement("li",{className:"ds-c-autocomplete__list-item--message"},this.props.noResultsMessage)}},{key:"renderChildren",value:function renderChildren(getInputProps){var _this3=this;return _react2.default.Children.map(this.props.children,(function(child){if(isTextField(child)){var propOverrides={"aria-controls":_this3.listboxId,id:_this3.id,onBlur:child.props.onBlur,onChange:child.props.onChange,onKeyDown:child.props.onKeyDown};return _react2.default.cloneElement(child,getInputProps(propOverrides))}return child}))}},{key:"render",value:function render(){var _this4=this,_props=this.props,ariaClearLabel=_props.ariaClearLabel,clearInputText=_props.clearInputText,items=_props.items,label=_props.label,loading=_props.loading,className=(_props.children,_props.className),autocompleteProps=_objectWithoutProperties(_props,["ariaClearLabel","clearInputText","items","label","loading","children","className"]),rootClassName=(0,_classnames2.default)("ds-u-clearfix","ds-c-autocomplete",className);return _react2.default.createElement(_downshift2.default,_extends({render:function render(_ref){var clearSelection=_ref.clearSelection,getInputProps=_ref.getInputProps,getItemProps=_ref.getItemProps,highlightedIndex=_ref.highlightedIndex,inputValue=_ref.inputValue,isOpen=_ref.isOpen;return _react2.default.createElement("div",{className:rootClassName},_this4.renderChildren(getInputProps),isOpen&&(loading||items)?_react2.default.createElement("div",{className:"ds-u-border--1 ds-u-padding--1 ds-c-autocomplete__list"},label&&!loading&&_react2.default.createElement("h5",{className:"ds-u-margin--0 ds-u-padding--1",id:_this4.labelId},label),_react2.default.createElement("ul",{"aria-labelledby":label?_this4.labelId:null,className:"ds-c-list--bare",id:_this4.listboxId,role:"listbox"},_this4.filterItems(items,inputValue,getInputProps,getItemProps,highlightedIndex))):null,_react2.default.createElement(_Button2.default,{"aria-label":ariaClearLabel,className:"ds-u-float--right ds-u-padding-right--0",onClick:clearSelection,size:"small",variation:"transparent"},clearInputText))}},autocompleteProps))}}]),Autocomplete}();Autocomplete.defaultProps={ariaClearLabel:"Clear typeahead and search again",clearInputText:"Clear search",itemToString:function itemToString(item){return item?item.name:""},loadingMessage:"Loading...",noResultsMessage:"No results"},Autocomplete.propTypes={ariaClearLabel:_propTypes2.default.string,children:_propTypes2.default.node,className:_propTypes2.default.string,clearInputText:_propTypes2.default.node,itemToString:_propTypes2.default.func,items:_propTypes2.default.arrayOf(_propTypes2.default.shape({id:_propTypes2.default.string,name:_propTypes2.default.string})),label:_propTypes2.default.node,loading:_propTypes2.default.bool,loadingMessage:_propTypes2.default.node,noResultsMessage:_propTypes2.default.node,onChange:_propTypes2.default.func,onInputValueChange:_propTypes2.default.func},exports.default=Autocomplete;