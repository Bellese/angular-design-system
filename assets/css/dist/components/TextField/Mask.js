"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Mask=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.unmask=unmask;var _propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_react=require("react"),_react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var deliminatedMaskRegex={phone:/(\d{3})(\d{1,3})?(\d+)?/,ssn:/(\d{3})(\d{1,2})?(\d+)?/,zip:/(\d{5})(\d+)/};function deliminateRegexGroups(value,rx){var matches=toInt(value).match(rx);return matches&&matches.length>1&&(value=matches.slice(1).filter((function(a){return!!a})).join("-")),value}function stringWithFixedDigits(value){var digits=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,decimalRegex=/\.[\d]+$/,decimal=value.match(decimalRegex);if(decimal){var fixedDecimal=parseFloat(decimal).toFixed(digits).match(decimalRegex)[0];return value.replace(decimal,fixedDecimal)}return value}function toInt(value){return value.replace(/\D+/g,"")}function toNumber(value){if("string"!=typeof value)return value;var parts=value.split("."),digitsRegex=/^-|\d/g,a=parts[0].match(digitsRegex).join(""),b=parts.length>=2&&parts[1].match(digitsRegex).join("");return b?parseFloat(a+"."+b):parseInt(a)}var Mask=exports.Mask=function(_React$PureComponent){function Mask(props){_classCallCheck(this,Mask);var _this=_possibleConstructorReturn(this,(Mask.__proto__||Object.getPrototypeOf(Mask)).call(this,props));return _this.state={value:_this.maskedValue(_this.initialValue())},_this}return _inherits(Mask,_react2.default.PureComponent),_createClass(Mask,[{key:"componentDidUpdate",value:function componentDidUpdate(){this.debouncedOnBlurEvent&&(this.field().props.onBlur(this.debouncedOnBlurEvent),this.debouncedOnBlurEvent=null)}},{key:"field",value:function field(){return _react2.default.Children.only(this.props.children)}},{key:"maskedValue",value:function maskedValue(){var value=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(value&&"string"==typeof value){var mask=this.props.mask;value=value.trim(),"currency"===mask?value=stringWithFixedDigits(toNumber(value).toLocaleString("en-US")):Object.keys(deliminatedMaskRegex).includes(mask)&&(value=deliminateRegexGroups(value,deliminatedMaskRegex[mask]))}return value}},{key:"handleBlur",value:function handleBlur(evt,field){var value=this.maskedValue(evt.target.value),debounce=value!==this.state.value&&"function"==typeof field.props.onBlur;debounce&&(evt.persist(),this.debouncedOnBlurEvent=evt),this.setState({value:value}),debounce||"function"!=typeof field.props.onBlur||field.props.onBlur(evt)}},{key:"handleChange",value:function handleChange(evt,field){this.setState({value:evt.target.value}),"function"==typeof field.props.onChange&&field.props.onChange(evt)}},{key:"initialValue",value:function initialValue(){var field=this.field();return field.props.value||field.props.defaultValue}},{key:"render",value:function render(){var _this2=this,field=this.field();return _react2.default.cloneElement(field,{defaultValue:void 0,onBlur:function onBlur(evt){return _this2.handleBlur(evt,field)},onChange:function onChange(evt){return _this2.handleChange(evt,field)},value:this.state.value})}}]),Mask}();function unmask(value,mask){if(!value||"string"!=typeof value)return value;var rawValue=value;if(value=value.trim(),"currency"===mask)value=value.match(/^-|[\d.]/g).join("");else{if(!Object.keys(deliminatedMaskRegex).includes(mask))return rawValue;value=toInt(value)}return value}Mask.propTypes={children:_propTypes2.default.node.isRequired,mask:_propTypes2.default.string.isRequired},exports.default=Mask;